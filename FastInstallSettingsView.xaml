<UserControl x:Class="FastInstall.FastInstallSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:FastInstall"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="950">

    <UserControl.Resources>
        <local:ConflictResolutionToLocalizedStringConverter x:Key="ConflictResolutionToLocalizedStringConverter"/>
        <local:LocalizedStringConverter x:Key="LocalizedStringConverter"/>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TabControl for multiple settings pages -->
        <TabControl Grid.Row="0">
            
            <!-- TAB 1: Local Sources -->
            <TabItem Header="{DynamicResource LOCFastInstall_Settings_Tab_LocalSources}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15">
                    <StackPanel>
                        <!-- Header -->
                        <TextBlock Text="{DynamicResource LOCFastInstall_Settings_Local_Title}" 
                                   FontSize="18" 
                                   FontWeight="Bold"
                                   Margin="0,0,0,10"/>

                        <!-- Description -->
                        <TextBlock Text="{DynamicResource LOCFastInstall_Settings_Local_Description}"
                                   TextWrapping="Wrap" 
                                   Margin="0,0,0,15"
                                   Opacity="0.8"/>

                        <!-- DataGrid for Local Sources -->
                        <DataGrid ItemsSource="{Binding EditingConfigurations}"
                                  SelectedItem="{Binding SelectedConfiguration, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  SelectionMode="Single"
                                  HeadersVisibility="All"
                                  GridLinesVisibility="All"
                                  AlternatingRowBackground="#10000000"
                                  MinHeight="150"
                                  MaxHeight="250"
                                  Margin="0,0,0,10">

                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="{DynamicResource LOCFastInstall_Settings_Column_Enabled}" 
                                                        Width="40"
                                                        Binding="{Binding IsEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_Column_SourcePath}" Width="2*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <Button Content="..." 
                                                        DockPanel.Dock="Right" 
                                                        Width="30" 
                                                        Margin="5,0,0,0"
                                                        Command="{Binding DataContext.BrowseSourceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"/>
                                                <TextBox Text="{Binding SourcePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalContentAlignment="Center"
                                                         Padding="5,2"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_Column_DestinationPath}" Width="2*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <Button Content="..." 
                                                        DockPanel.Dock="Right" 
                                                        Width="30" 
                                                        Margin="5,0,0,0"
                                                        Command="{Binding DataContext.BrowseDestinationCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"/>
                                                <TextBox Text="{Binding DestinationPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalContentAlignment="Center"
                                                         Padding="5,2"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_Column_Platform}" Width="130">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding DataContext.AvailablePlatforms, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                      SelectedItem="{Binding Platform, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      VerticalContentAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_Column_Emulator}" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding DataContext.AvailableEmulators, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                      DisplayMemberPath="DisplayName"
                                                      SelectedValuePath="EmulatorId"
                                                      SelectedValue="{Binding EmulatorId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      VerticalContentAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_Column_Profile}" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding AvailableProfilesForEmulator}"
                                                      DisplayMemberPath="DisplayName"
                                                      SelectedValuePath="ProfileId"
                                                      SelectedValue="{Binding EmulatorProfileId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      VerticalContentAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Buttons -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <Button Content="{DynamicResource LOCFastInstall_Settings_Button_AddConfig}" 
                                    Padding="15,8" 
                                    Margin="0,0,10,0"
                                    Command="{Binding AddConfigurationCommand}"/>
                            <Button Content="{DynamicResource LOCFastInstall_Settings_Button_RemoveSelected}" 
                                    Padding="15,8"
                                    Command="{Binding RemoveConfigurationCommand}"/>
                        </StackPanel>

                        <!-- General Settings -->
                        <Border Background="#15000000" CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_General_Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <CheckBox x:Name="EnableParallelCheckBox"
                                              Content="{DynamicResource LOCFastInstall_Settings_EnableParallel}"
                                              IsChecked="{Binding Settings.EnableParallelDownloads, Mode=TwoWay}"
                                              VerticalContentAlignment="Center"
                                              Margin="0,0,15,0"
                                              Checked="EnableParallelCheckBox_Checked"
                                              Unchecked="EnableParallelCheckBox_Unchecked"/>
                                    <TextBlock Text="{DynamicResource LOCFastInstall_Settings_MaxParallel_Label}" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <TextBox x:Name="MaxParallelTextBox"
                                             Text="{Binding Settings.MaxParallelDownloads, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Width="50" Height="22"
                                             VerticalContentAlignment="Center"
                                             TextAlignment="Center"
                                             IsEnabled="{Binding ElementName=EnableParallelCheckBox, Path=IsChecked}"
                                             PreviewTextInput="MaxParallelTextBox_PreviewTextInput"
                                             LostFocus="MaxParallelTextBox_LostFocus"/>
                                    <TextBlock Text="{DynamicResource LOCFastInstall_Settings_MaxParallel_Hint}" Opacity="0.7" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="11"/>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="{DynamicResource LOCFastInstall_Settings_ConflictResolution_Label}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="ConflictResolutionComboBox"
                                              SelectedItem="{Binding Settings.ConflictResolution, Mode=TwoWay}"
                                              Width="200" VerticalContentAlignment="Center">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource ConflictResolutionToLocalizedStringConverter}}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{DynamicResource LOCFastInstall_Settings_SevenZipPath_Label}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBox Text="{Binding Settings.SevenZipPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Width="280" Height="22"
                                             VerticalContentAlignment="Center" Margin="0,0,10,0"/>
                                    <Button Content="{DynamicResource LOCFastInstall_Settings_Button_Browse}" Width="80" Height="22" Click="BrowseSevenZipButton_Click" Margin="0,0,10,0"/>
                                    <Button Content="{DynamicResource LOCFastInstall_Settings_Button_Download7Zip}" Width="100" Height="22" Click="DownloadSevenZipButton_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Info Box -->
                        <Border Background="#20808080" CornerRadius="5" Padding="15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_SupportedPlatforms_Title}" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap" FontSize="11" Opacity="0.9">
                                    <Run Text="{DynamicResource LOCFastInstall_Settings_SupportedPlatforms_Text}"/>
                                </TextBlock>
                                
                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_ConfigureEmulators_Title}" FontWeight="Bold" Margin="0,10,0,5"/>
                                <TextBlock TextWrapping="Wrap" FontSize="11" Opacity="0.9">
                                    <Run Text="{DynamicResource LOCFastInstall_Settings_ConfigureEmulators_Text}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- TAB 2: Cloud Sources (Google Drive) -->
            <TabItem Header="{DynamicResource LOCFastInstall_Settings_Tab_GoogleDrive}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15">
                    <StackPanel>
                        <!-- Header -->
                        <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_Title}" 
                                   FontSize="18" 
                                   FontWeight="Bold"
                                   Margin="0,0,0,10"/>

                        <!-- Description -->
                        <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_Description}"
                                   TextWrapping="Wrap" 
                                   Margin="0,0,0,15"
                                   Opacity="0.8"/>

                        <!-- API Key Section -->
                        <Border Background="#15000000" CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_ApiKey_Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                                
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,10" Opacity="0.9">
                                    <Run Text="{DynamicResource LOCFastInstall_Settings_GD_ApiKey_Description}"/>
                                </TextBlock>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_ApiKey_Label}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBox x:Name="GoogleApiKeyTextBox"
                                             Text="{Binding Settings.GoogleDriveApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Width="400" Height="22"
                                             VerticalContentAlignment="Center"/>
                                </StackPanel>

                                <Button Content="{DynamicResource LOCFastInstall_Settings_GD_Button_HowToApiKey}" 
                                        HorizontalAlignment="Left"
                                        Padding="10,5"
                                        Click="ShowApiKeyHelpButton_Click"/>
                            </StackPanel>
                        </Border>

                        <!-- Cloud Sources DataGrid -->
                        <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_CloudSources_Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                        
                        <DataGrid ItemsSource="{Binding EditingCloudSources}"
                                  SelectedItem="{Binding SelectedCloudSource, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  SelectionMode="Single"
                                  HeadersVisibility="All"
                                  GridLinesVisibility="All"
                                  AlternatingRowBackground="#10000000"
                                  MinHeight="150"
                                  MaxHeight="250"
                                  Margin="0,0,0,10">

                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="{DynamicResource LOCFastInstall_Settings_Column_Enabled}" 
                                                        Width="40"
                                                        Binding="{Binding IsEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                <DataGridTextColumn Header="{DynamicResource LOCFastInstall_Settings_GD_Column_Name}" 
                                                    Width="150"
                                                    Binding="{Binding DisplayName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_GD_Column_Link}" Width="2*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <Button Content="{DynamicResource LOCFastInstall_Settings_GD_Button_Test}" 
                                                        DockPanel.Dock="Right" 
                                                        Width="50" 
                                                        Margin="5,0,0,0"
                                                        Command="{Binding DataContext.TestCloudConnectionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"/>
                                                <TextBox Text="{Binding CloudLink, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalContentAlignment="Center"
                                                         Padding="5,2"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_GD_Column_DestinationPath}" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <Button Content="..." 
                                                        DockPanel.Dock="Right" 
                                                        Width="30" 
                                                        Margin="5,0,0,0"
                                                        Command="{Binding DataContext.BrowseCloudDestinationCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                        CommandParameter="{Binding}"/>
                                                <TextBox Text="{Binding DestinationPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                         VerticalContentAlignment="Center"
                                                         Padding="5,2"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="{DynamicResource LOCFastInstall_Settings_Column_Platform}" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding DataContext.AvailablePlatforms, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                      SelectedItem="{Binding Platform, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      VerticalContentAlignment="Center"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Buttons -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <Button Content="{DynamicResource LOCFastInstall_Settings_GD_Button_AddSource}" 
                                    Padding="15,8" 
                                    Margin="0,0,10,0"
                                    Command="{Binding AddCloudSourceCommand}"/>
                            <Button Content="{DynamicResource LOCFastInstall_Settings_Button_RemoveSelected}" 
                                    Padding="15,8"
                                    Command="{Binding RemoveCloudSourceCommand}"/>
                        </StackPanel>

                        <!-- Help Box -->
                        <Border Background="#20808080" CornerRadius="5" Padding="15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_Help_Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                                
                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_Help_LinkTypes_Title}" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,5">
                                    <Run Text="{DynamicResource LOCFastInstall_Settings_GD_Help_LinkTypes_Direct}"/>
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,10">
                                    <Run Text="{DynamicResource LOCFastInstall_Settings_GD_Help_LinkTypes_Folder}"/>
                                </TextBlock>

                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_Help_SupportedFormats_Title}" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap" FontSize="11" Opacity="0.8" FontFamily="Consolas" Margin="0,0,0,5">
                                    https://drive.google.com/file/d/FILE_ID/view
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="11" Opacity="0.8" FontFamily="Consolas" Margin="0,0,0,5">
                                    https://drive.google.com/drive/folders/FOLDER_ID
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="11" Opacity="0.8" FontFamily="Consolas" Margin="0,0,0,10">
                                    https://drive.google.com/open?id=FILE_ID
                                </TextBlock>

                                <TextBlock Text="{DynamicResource LOCFastInstall_Settings_GD_Help_ArchiveSupport_Title}" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9">
                                    <Run Text="{DynamicResource LOCFastInstall_Settings_GD_Help_ArchiveSupport_Text}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- TAB 3: About -->
            <TabItem Header="{DynamicResource LOCFastInstall_Settings_Tab_About}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15">
                    <StackPanel>
                        <TextBlock Text="FastInstall" 
                                   FontSize="24" 
                                   FontWeight="Bold"
                                   Margin="0,0,0,5"/>
                        
                        <TextBlock Text="{Binding PluginVersionText}"
                                   FontSize="14"
                                   Foreground="LimeGreen"
                                   FontWeight="Bold"
                                   Margin="0,0,0,20"/>

                        <TextBlock Text="{DynamicResource LOCFastInstall_About_Description}"
                                   TextWrapping="Wrap" 
                                   Margin="0,0,0,20"
                                   Opacity="0.9"/>

                        <!-- Download Manager Button -->
                        <Button Content="{DynamicResource LOCFastInstall_About_Button_OpenDownloadManager}" 
                                HorizontalAlignment="Left"
                                Padding="20,10"
                                Margin="0,0,0,20"
                                Click="OpenDownloadManagerButton_Click"
                                Background="#4CAF50"
                                Foreground="White"
                                FontWeight="Bold"
                                BorderThickness="0"/>

                        <Border Background="#20808080" CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCFastInstall_About_Features_Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,3"><Run Text="{DynamicResource LOCFastInstall_About_Feature_1}"/></TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,3"><Run Text="{DynamicResource LOCFastInstall_About_Feature_2}"/></TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,3"><Run Text="{DynamicResource LOCFastInstall_About_Feature_3}"/></TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,3"><Run Text="{DynamicResource LOCFastInstall_About_Feature_4}"/></TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,3"><Run Text="{DynamicResource LOCFastInstall_About_Feature_5}"/></TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9" Margin="0,0,0,3"><Run Text="{DynamicResource LOCFastInstall_About_Feature_6}"/></TextBlock>
                                <TextBlock TextWrapping="Wrap" FontSize="12" Opacity="0.9"><Run Text="{DynamicResource LOCFastInstall_About_Feature_7}"/></TextBlock>
                            </StackPanel>
                        </Border>

                        <Border Background="#20808080" CornerRadius="5" Padding="15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCFastInstall_About_Author_Title}" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                                <TextBlock Text="sassoanarchico" FontSize="12" Opacity="0.9"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
